<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>Lorem ipsum dolor, sit amet consectetur adipisicing elit.&gt;</div>
    <div>Voluptate aliquam provident itaque veritatis minus,</div>
    <div>officiis rem dicta voluptatibus corporis sunt,</div>
    <div>
      cumque iure quos nobis similique molestias magni neque omnis commodi!
    </div>
    <div>
      <table>
        <thead>
          <tr>
            <th>a</th>
            <th>b</th>
            <th>c</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1 ia 2</td>
            <td>2</td>
            <td>3</td>
          </tr>
          <tr>
            <td>1</td>
            <td>2</td>
            <td>3</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <div>
      Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima magni nisi
      fugit optio, nam qui vitae adipisci ullam rerum aut libero dolorum,
      exercitationem pariatur ipsam consequuntur maiores, aliquid in assumenda.
    </div>
    <script>
      var Searcher = (function () {
        function Searcher() {
          this.result = [];
        }

        Searcher.prototype.searchCore = function (text) {
          var xPathResult = document.evaluate(
            `//*[contains(text(), "${text.replace(/"/g, '"')}")]`,
            document,
            null,
            XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
            null
          );

          if (xPathResult.snapshotLength) {
            var result = [];
            var len = xPathResult.snapshotLength;
            var tagsToBeExcluded = ['script', 'style'];
            while (len--) {
              var node = xPathResult.snapshotItem(len);
              var beExcluded =
                tagsToBeExcluded.findIndex(
                  (tag) => tag === node.nodeName.toLowerCase()
                ) >= 0;
              if (beExcluded) {
                // exclude
              } else {
                result.push(node);
              }
            }
            return result;
          } else {
            return;
          }
        };

        Searcher.prototype.search = function (text) {
          if (this.result.length > 0) {
            this.reset();
          }

          var hits = this.searchCore(text);
          if (hits && hits.length) {
            for (var i = 0; i < hits.length; i++) {
              var element = hits[i];
              this.result.push({
                element: element,
                bufferedHTML: element.innerHTML,
                borderStyle: element.style.border,
              });

              element.style.border = '5px solid red';
              var regexEscaped = text; // ToDo: . や * などの正規表現の特殊文字をエスケープしなければならない。
              var htmlEscaped = text; // ToDo: <> やらなんやらをエスケープしなければならない。
              element.innerHTML = element.innerHTML.replace(
                new RegExp(regexEscaped, 'g'),
                `<span style="background-color: yellow; color: black;">${htmlEscaped}</span>`
              );
            }
          }
        };

        Searcher.prototype.reset = function () {
          while (this.result.length) {
            var item = this.result.pop();
            item.element.innerHTML = item.bufferedHTML;
            item.element.style.border = item.borderStyle;
          }
        };

        return Searcher;
      })();

      window.searcher = new Searcher();
    </script>
  </body>
</html>
